name: Automatically promote the haproxy and the haproxy-spoe-auth charm

on:
  schedule:
    - cron: 0 9 * * 1 # At 09:00 on Monday

jobs:
  promote-haproxy-charm-candidate-to-stable:
    environment: release
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    with:
      origin-channel: 2.8/candidate
      destination-channel: 2.8/stable
      working-directory: ./haproxy-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64
    secrets:
      CHARMHUB_TOKEN:
        required: true

  promote-haproxy-charm-edge-to-candidate:
    needs: [promote-haproxy-charm-candidate-to-stable]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    with:
      origin-channel: 2.8/edge
      destination-channel: 2.8/candidate
      working-directory: ./haproxy-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64
    secrets:
      CHARMHUB_TOKEN:
        required: true

  promote-haproxy-spoe-auth-charm-candidate-to-stable:
    environment: release
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    with:
      origin-channel: latest/candidate
      destination-channel: latest/stable
      working-directory: ./haproxy-spoe-auth-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64
    secrets:
      CHARMHUB_TOKEN:
        required: true

  promote-haproxy-spoe-auth-charm-edge-to-candidate:
    needs: [promote-haproxy-spoe-auth-charm-candidate-to-stable]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    with:
      origin-channel: latest/edge
      destination-channel: latest/candidate
      working-directory: ./haproxy-spoe-auth-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64
    secrets:
      CHARMHUB_TOKEN:
        required: true
