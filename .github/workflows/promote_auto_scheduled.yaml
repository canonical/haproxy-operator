name: Automatically promote the haproxy and the haproxy-spoe-auth charm

on:
  workflow_dispatch:
  schedule:
    - cron: 0 9 * * 1 # At 09:00 on Monday

jobs:
  require-approval:
    environment: charmhub-stable-promote
    runs-on: ubuntu-latest
    steps:
    - run: echo "Workflow has been approved"
  
  promote-haproxy-charm-candidate-to-stable:
    needs: [require-approval]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    secrets: inherit
    with:
      origin-channel: 2.8/candidate
      destination-channel: 2.8/stable
      working-directory: ./haproxy-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64

  promote-haproxy-charm-edge-to-candidate:
    needs: [promote-haproxy-charm-candidate-to-stable]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    secrets: inherit
    with:
      origin-channel: 2.8/edge
      destination-channel: 2.8/candidate
      working-directory: ./haproxy-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64

  promote-haproxy-spoe-auth-charm-candidate-to-stable:
    needs: [require-approval]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    secrets: inherit
    with:
      origin-channel: latest/candidate
      destination-channel: latest/stable
      working-directory: ./haproxy-spoe-auth-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64

  promote-haproxy-spoe-auth-charm-edge-to-candidate:
    needs: [promote-haproxy-spoe-auth-charm-candidate-to-stable]
    uses: canonical/operator-workflows/.github/workflows/promote_charm.yaml@main
    secrets: inherit
    with:
      origin-channel: latest/edge
      destination-channel: latest/candidate
      working-directory: ./haproxy-spoe-auth-operator
      base-channel: 24.04
      base-name: ubuntu
      base-architecture: amd64