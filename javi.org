multipass launch --cpus 12 --disk 80G --memory 12G --name haproxyoauth 24.04
multipass shell haproxyoauth
sudo snap install astral-uv --classic
uv tool install tox --with tox-uv # use uv to install
sudo poweroff
multipass mount --type native /home/jpuente/github haproxyoauth:/home/ubuntu/github
multipass shell haproxyoauth

sudo snap install astral-uv --classic
uv tool install tox --with tox-uv # use uv to install

sudo snap install k8s --classic
sudo k8s bootstrap


sudo k8s set load-balancer.l2-mode=true
sudo k8s set load-balancer.cidrs=10.168.161.120/28
sudo k8s set load-balancer.enabled=true

sudo snap install juju

mkdir -p ~/.local/share/juju
sudo k8s config | juju add-k8s ck8s --client
juju bootstrap ck8s  # This should not necessary, just to be similar to the pipeline

sudo snap install jhack
sudo snap connect jhack:dot-local-share-juju snapd

lxd init --auto
lxc network set lxdbr0 ipv6.address none

cd github/canonical/haproxy-operator/
time tox -e integration --  -x  --log-cli-level=INFO  --log-format="%(asctime)s %(levelname)s %(message)s" --charm-file=./haproxy-operator/haproxy_amd64.charm --charm-file=./haproxy-spoe-auth-operator/haproxy-spoe-auth_amd64.charm --model testing --keep-models ./tests/integration/test_oauth_spoe.py



***
multipass exec haproxyoauth  -- bash -c "echo `cat ~/.ssh/id_ed25519.pub` >> ~/.ssh/authorized_keys"
ssh -X ubuntu@thepi
sudo snap install firefox
export XAUTHORITY=$HOME/.Xauthority
firefox
